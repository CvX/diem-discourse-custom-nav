<script>
	$(document).ready(function() {
		
		function calcWidth() {
			var navwidth = 0;
			var morewidth = $('.nav-link-container .more').outerWidth(true);
			$('.nav-link-container > li:not(.more)').each(function() {
				navwidth += $(this).outerWidth( true );
			});
			
			var availablespace = $('.header-buttons').width() - morewidth;

			if (navwidth > availablespace) {
				var lastItem = $('.nav-link-container > li:not(.more)').last();
				lastItem.attr('data-width', lastItem.outerWidth(true));
				lastItem.prependTo($('.nav-link-container .more ul'));
				calcWidth();
			} else {
				
			var firstMoreElement = $('.nav-link-container li.more li').first();
			if (navwidth + firstMoreElement.data('width') < availablespace) {
				firstMoreElement.insertBefore($('.nav-link-container .more'));
			}
		}
			
		if ($('.nav-link-container .more li').length > 0) {
			$('.nav-link-container .more').css('display','block');
			} else {
				$('.nav-link-container .more').css('display','none');
			}
		}
		
		$('.nav-link-container .more').on('click', 'li', function(e) {
			e.preventDefault();
			$('.nav-link-container .more').toggleClass('visible');
		});

		$(window).on('resize load',function(){
			calcWidth();
		});




		// Observe header for changes to recalculate width

		var targetNodes         = $(".d-header");
		var MutationObserver    = window.MutationObserver || window.WebKitMutationObserver;
		var myObserver          = new MutationObserver (mutationHandler);
		var obsConfig           = { childList: false, characterData: false, attributes: true, subtree: false };

		//--- Add a target node to the observer. Can only add one node at a time.
		targetNodes.each ( function () {
				myObserver.observe (this, obsConfig);
		} );

		function mutationHandler (mutationRecords) {
				console.info ("mutationHandler:");

				mutationRecords.forEach ( function (mutation) {
						console.log (mutation);

						if (typeof mutation.attributeName == "class") {
							calcWidth();
						}
				} );
		}


	});
</script>